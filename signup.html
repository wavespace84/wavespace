<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íšŒì›ê°€ì… - WAVE SPACE</title>
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- í™˜ê²½ ì„¤ì • -->
    <script src="config.dev.js"></script>
    
    <!-- XSS ë³´í™˜ ë° ì—ëŸ¬ í•¸ë“¤ëŸ¬ -->
    <script src="js/utils/xssProtection.js"></script>
    <script src="js/utils/errorHandler.js"></script>
    
    <!-- CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="common.css?v=7" />
    <link rel="stylesheet" href="styles.css?v=7" />
    <link rel="stylesheet" href="css/sidebar.css?v=7" />
    <link rel="stylesheet" href="signup.css?v=7" />
    <link rel="stylesheet" href="mobile-fix.css?v=7" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- ê¸°ë³¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="preload.js"></script>
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- ì „ì—­ ë°ì´í„° ì‹œìŠ¤í…œ -->
    <script src="js/core/WaveSpaceData.js?v=7"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body data-page="signup">
    <!-- ì „ì²´ ì»¨í…Œì´ë„ˆ -->
    <div class="app-container">
        <!-- ì‚¬ì´ë“œë°” (ë™ì  ë¡œë“œ) -->

        <div id="sidebar-container">
            <!-- SidebarLoaderê°€ ë™ì ìœ¼ë¡œ ì‚¬ì´ë“œë°”ë¥¼ ì—¬ê¸°ì— ë¡œë“œí•©ë‹ˆë‹¤ -->
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <div class="main-container">
            <!-- í—¤ë” (ë™ì  ë¡œë“œ) -->
            <div id="header-container">
                <!-- HeaderLoaderê°€ ë™ì ìœ¼ë¡œ í—¤ë”ë¥¼ ì—¬ê¸°ì— ë¡œë“œí•©ë‹ˆë‹¤ -->
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <main class="main-content">
                <div class="signup-container">
                    <!-- í—¤ë” -->
                    <div class="page-header">
                        <h1 class="page-title">íšŒì›ê°€ì…</h1>
                        <p class="signup-subtitle">ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
                    </div>

                    <!-- íšŒì›ê°€ì… í¼ -->
                    <div class="signup-card">
                        <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user"></i>
                                ê¸°ë³¸ ì •ë³´
                            </h3>
                            <p class="section-description">íšŒì›ê°€ì…ì— í•„ìš”í•œ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

                            <form id="signupForm" onsubmit="handleSignup(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="userId">
                                            ì•„ì´ë”” <span class="required">*</span>
                                        </label>
                                        <div class="input-with-button">
                                            <input type="text" id="userId" class="form-input" required 
                                                   placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" minlength="4" maxlength="20">
                                            <button type="button" class="check-btn" onclick="checkUserIdDuplicate()">ì¤‘ë³µí™•ì¸</button>
                                        </div>
                                        <div id="userIdStatus" class="field-status"></div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" for="nickname">
                                            ë‹‰ë„¤ì„ <span class="required">*</span>
                                        </label>
                                        <div class="input-with-button">
                                            <input type="text" id="nickname" class="form-input" required 
                                                   placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" minlength="2" maxlength="15">
                                            <button type="button" class="check-btn" onclick="checkNicknameDuplicate()">ì¤‘ë³µí™•ì¸</button>
                                        </div>
                                        <div id="nicknameStatus" class="field-status"></div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="password">
                                            ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span>
                                        </label>
                                        <input type="password" id="password" class="form-input" required 
                                               placeholder="8ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ì í¬í•¨" minlength="8">
                                        <div class="password-requirements">
                                            <span class="requirement" id="lengthReq">âœ— 8ì ì´ìƒ</span>
                                            <span class="requirement" id="specialReq">âœ— íŠ¹ìˆ˜ë¬¸ì</span>
                                            <span class="requirement" id="numberReq">âœ— ìˆ«ì</span>
                                        </div>
                                        <div id="passwordStatus" class="field-status"></div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" for="confirmPassword">
                                            ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="required">*</span>
                                        </label>
                                        <input type="password" id="confirmPassword" class="form-input" required 
                                               placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" minlength="8">
                                        <div id="confirmPasswordStatus" class="field-status"></div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="email">
                                            ì´ë©”ì¼ <span class="required">*</span>
                                        </label>
                                        <input type="email" id="email" class="form-input" required 
                                               placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                                        <div id="emailStatus" class="field-status"></div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" for="fullName">
                                            ì‹¤ëª… <span class="required">*</span>
                                        </label>
                                        <input type="text" id="fullName" class="form-input" required 
                                               placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="phone">
                                            ì—°ë½ì²˜ <span class="required">*</span>
                                        </label>
                                        <div class="input-with-button">
                                            <input type="tel" id="phone" class="form-input" required 
                                                   placeholder="010-1234-5678" pattern="010-[0-9]{4}-[0-9]{4}">
                                            <button type="button" class="check-btn" id="requestVerificationBtn" onclick="requestPhoneVerification()" disabled style="opacity: 0.6;">ë³¸ì¸ì¸ì¦</button>
                                        </div>
                                        <div id="phoneStatus" class="field-status"></div>
                                        
                                        <!-- reCAPTCHA ì»¨í…Œì´ë„ˆ (visible ëª¨ë“œ) -->
                                        <div class="recaptcha-wrapper" style="margin: 16px 0;">
                                            <div id="recaptcha-container">
                                                <div style="width: 304px; height: 78px; border: 2px dashed #d3d3d3; border-radius: 3px; background: #f9f9f9; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #666;">
                                                    <i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>
                                                    reCAPTCHA ë¡œë”© ì¤‘...
                                                </div>
                                            </div>
                                            <div class="recaptcha-help-text" id="recaptcha-help-text" style="display: none;">
                                                ë¡œë´‡ì´ ì•„ë‹˜ì„ ì²´í¬í•œ í›„ ë³¸ì¸ì¸ì¦ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                                                <br><span style="font-size: 10px; color: #999;">(localhostì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ë™ì‘í•©ë‹ˆë‹¤)</span>
                                            </div>
                                        </div>
                                        
                                        <!-- ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ì„¹ì…˜ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
                                        <div id="verificationSection" class="verification-section" style="display: none;">
                                            
                                            <div class="form-group verification-group">
                                                <label class="form-label" for="verificationCode">
                                                    ì¸ì¦ë²ˆí˜¸ <span class="required">*</span>
                                                </label>
                                                <div class="input-with-button">
                                                    <input type="text" id="verificationCode" class="form-input" 
                                                           placeholder="6ìë¦¬ ì¸ì¦ë²ˆí˜¸ ì…ë ¥" maxlength="6" pattern="[0-9]{6}">
                                                    <button type="button" class="check-btn" onclick="verifyPhoneCode()">í™•ì¸</button>
                                                </div>
                                                <div class="verification-info">
                                                    <span id="verificationTimer" class="timer">03:00</span>
                                                    <button type="button" class="resend-btn" id="resendBtn" onclick="requestPhoneVerification()" disabled>ì¬ë°œì†¡</button>
                                                </div>
                                                <div id="verificationCodeStatus" class="field-status"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>

                        <!-- íšŒì› ìœ í˜• ì„ íƒ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-briefcase"></i>
                                íšŒì› ìœ í˜•
                            </h3>
                            <p class="section-description">ê·€í•˜ì˜ ì§ì—…ì´ë‚˜ ê´€ì‹¬ ë¶„ì•¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                            
                            <div class="member-type-list">
                                <div class="member-type-item selected" onclick="selectMemberType('ì¼ë°˜')">
                                    <input type="radio" name="memberType" value="ì¼ë°˜" id="general" checked>
                                    <div class="member-type-title">ì¼ë°˜ íšŒì›</div>
                                    <div class="member-type-desc">ë¶€ë™ì‚°ì— ê´€ì‹¬ ìˆëŠ” ì¼ë°˜ì¸</div>
                                </div>

                                <div class="member-type-item" onclick="selectMemberType('ë¶„ì–‘ê¸°íš')" data-practitioner="true">
                                    <input type="radio" name="memberType" value="ë¶„ì–‘ê¸°íš" id="planning">
                                    <div class="member-type-title">ë¶„ì–‘ê¸°íš</div>
                                    <div class="member-type-desc">ë¶„ì–‘ê¸°íš ì—…ë¬´ ë‹´ë‹¹ì <span class="practitioner-badge">ì‹¤ë¬´ì ì¸ì¦ ê°€ëŠ¥</span></div>
                                </div>

                                <div class="member-type-item" onclick="selectMemberType('ë¶„ì–‘ì˜ì—…')">
                                    <input type="radio" name="memberType" value="ë¶„ì–‘ì˜ì—…" id="sales">
                                    <div class="member-type-title">ë¶„ì–‘ì˜ì—…</div>
                                    <div class="member-type-desc">ë¶„ì–‘ì˜ì—… ì—…ë¬´ ë‹´ë‹¹ì</div>
                                </div>

                                <div class="member-type-item" onclick="selectMemberType('ì²­ì•½ìƒë‹´')">
                                    <input type="radio" name="memberType" value="ì²­ì•½ìƒë‹´" id="consulting">
                                    <div class="member-type-title">ì²­ì•½ìƒë‹´</div>
                                    <div class="member-type-desc">ì²­ì•½ìƒë‹´ ì—…ë¬´ ë‹´ë‹¹ì</div>
                                </div>

                                <div class="member-type-item" onclick="selectMemberType('ê´€ê³„ì‚¬')" data-practitioner="true">
                                    <input type="radio" name="memberType" value="ê´€ê³„ì‚¬" id="partner">
                                    <div class="member-type-title">ê´€ê³„ì‚¬</div>
                                    <div class="member-type-desc">í˜‘ë ¥ì—…ì²´ ë° ê´€ë ¨ ê¸°ì—… <span class="practitioner-badge">ì‹¤ë¬´ì ì¸ì¦ ê°€ëŠ¥</span></div>
                                </div>
                            </div>

                            <!-- ì‹¤ë¬´ì ì¸ì¦ ì•ˆë‚´ -->
                            <div id="practitionerNotice" class="practitioner-notice" style="display: none;">
                                <div class="notice-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="notice-content">
                                    <strong>ì‹¤ë¬´ì ì¸ì¦ ì•ˆë‚´</strong>
                                    <p>ë¶„ì–‘ê¸°íš, ê´€ê³„ì‚¬ íšŒì›ì€ ê°€ì… í›„ ë§ˆì´í˜ì´ì§€ì—ì„œ ì‹¤ë¬´ì ì¸ì¦ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                    <p>ì‹¤ë¬´ì ì¸ì¦ ì‹œ ì‹œì¥ì¡°ì‚¬ì„œ ë° ì œì•ˆì„œ ë‹¤ìš´ë¡œë“œ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤.</p>
                                </div>
                            </div>

                            <!-- ìƒì„¸ ì •ë³´ ì…ë ¥ (ì„ íƒí•œ ìœ í˜•ì— ë”°ë¼ í‘œì‹œ) -->
                            <div id="additionalInfoSection" class="additional-info" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="company">íšŒì‚¬ëª…</label>
                                        <input type="text" id="company" class="form-input" placeholder="ì†Œì† íšŒì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="department">ë¶€ì„œ/ì§ì±…</label>
                                        <input type="text" id="department" class="form-input" placeholder="ë¶€ì„œë‚˜ ì§ì±…ì„ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="experience">ê²½ë ¥</label>
                                    <select id="experience" class="form-input">
                                        <option value="">ê²½ë ¥ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                        <option value="ì‹ ì…">ì‹ ì…</option>
                                        <option value="1-3ë…„">1-3ë…„</option>
                                        <option value="3-5ë…„">3-5ë…„</option>
                                        <option value="5-10ë…„">5-10ë…„</option>
                                        <option value="10ë…„ ì´ìƒ">10ë…„ ì´ìƒ</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- ì•½ê´€ ë™ì˜ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-file-contract"></i>
                                ì•½ê´€ ë™ì˜
                            </h3>

                            <div class="terms-section">
                                <div class="terms-all" onclick="toggleAllTerms()">
                                    <div class="terms-checkbox" id="allTermsCheck">
                                        <i class="fas fa-check" style="display: none;"></i>
                                    </div>
                                    <div class="terms-text">
                                        <strong>ì „ì²´ ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤</strong>
                                    </div>
                                </div>

                                <div class="terms-list">
                                    <div class="terms-item" onclick="toggleTerm('terms1')">
                                        <div class="terms-checkbox" id="terms1Check">
                                            <i class="fas fa-check" style="display: none;"></i>
                                        </div>
                                        <div class="terms-text">
                                            <span class="required">*</span> ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜
                                        </div>
                                        <a href="#" class="terms-link">ë³´ê¸°</a>
                                    </div>

                                    <div class="terms-item" onclick="toggleTerm('terms2')">
                                        <div class="terms-checkbox" id="terms2Check">
                                            <i class="fas fa-check" style="display: none;"></i>
                                        </div>
                                        <div class="terms-text">
                                            <span class="required">*</span> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜
                                        </div>
                                        <a href="#" class="terms-link">ë³´ê¸°</a>
                                    </div>

                                    <div class="terms-item" onclick="toggleTerm('terms3')">
                                        <div class="terms-checkbox" id="terms3Check">
                                            <i class="fas fa-check" style="display: none;"></i>
                                        </div>
                                        <div class="terms-text">
                                            ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì„ íƒ)
                                        </div>
                                        <a href="#" class="terms-link">ë³´ê¸°</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì œì¶œ ì„¹ì…˜ -->
                        <div class="submit-section">
                            <button type="submit" class="btn-submit" id="submitBtn">
                                <span class="btn-text">íšŒì›ê°€ì…</span>
                                <div class="loading">
                                    <div class="spinner"></div>
                                </div>
                            </button>

                            <div id="errorMessage" class="error-message"></div>
                            <div id="successMessage" class="success-message"></div>
                        </div>

                        </form>

                        <!-- ë¡œê·¸ì¸ ë§í¬ -->
                        <div class="login-link">
                            ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? 
                            <a href="login.html">ë¡œê·¸ì¸í•˜ê¸°</a>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Supabase ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="js/config/supabase.js?v=7"></script>
    <script src="js/config/firebase.js?v=7"></script>
    <script src="js/services/phoneAuthService.js?v=7"></script>
    <script src="js/services/authService.js?v=7"></script>
    
    <!-- ë©”ì¸ ëª¨ë“ˆ (ES6 ëª¨ë“ˆ ì‹œìŠ¤í…œ) -->
    <script type="module" src="js/main.js?v=7"></script>
    
    <script>
        // í˜ì´ì§€ ë¡œë”© ì‹œ ì¦‰ì‹œ ë³´ì´ê²Œ í•˜ê¸°
        document.body.classList.add('loaded');

        // Firebase ìë™ ì´ˆê¸°í™” (í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„)
        document.addEventListener('DOMContentLoaded', () => {
            // Firebase ì„œë¹„ìŠ¤ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            let initAttempts = 0;
            const maxAttempts = 50; // 5ì´ˆ ëŒ€ê¸°
            
            const initFirebase = () => {
                if (window.firebaseService && typeof window.firebaseService.init === 'function') {
                    console.log('ğŸ”¥ Firebase ìë™ ì´ˆê¸°í™” ì‹œì‘...');
                    window.firebaseService.init();
                } else if (initAttempts < maxAttempts) {
                    initAttempts++;
                    setTimeout(initFirebase, 100);
                } else {
                    console.warn('âš ï¸ Firebase ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.');
                }
            };
            
            // 100ms í›„ ì´ˆê¸°í™” ì‹œì‘
            setTimeout(initFirebase, 100);
        });
        
        // ì „ì—­ ë³€ìˆ˜
        let isUserIdValid = false;
        let isNicknameValid = false;
        let isPhoneVerified = false;
        let verificationTimer = null;
        let timeLeft = 180; // 3ë¶„ = 180ì´ˆ
        let selectedMemberType = 'ì¼ë°˜'; // ê¸°ë³¸ê°’ì„ 'ì¼ë°˜'ìœ¼ë¡œ ì„¤ì •
        const termsAgreed = {
    terms1: false,
    terms2: false,
    terms3: false
};

        // ì•„ì´ë”” ì¤‘ë³µ í™•ì¸
        async function checkUserIdDuplicate() {
            const userId = document.getElementById('userId').value;
            const statusElement = document.getElementById('userIdStatus');
            const inputElement = document.getElementById('userId');
            
            if (!userId || userId.length < 4) {
                statusElement.textContent = 'ì•„ì´ë””ëŠ” 4ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                statusElement.className = 'field-status invalid';
                inputElement.className = 'form-input invalid';
                isUserIdValid = false;
                return;
            }
            
            try {
                statusElement.textContent = 'ì¤‘ë³µ í™•ì¸ ì¤‘...';
                statusElement.className = 'field-status checking';
                inputElement.className = 'form-input checking';
                
                // authServiceê°€ ì—†ê±°ë‚˜ í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í†µê³¼ (ê°œë°œ ëª¨ë“œ)
                if (!window.authService || typeof window.authService.checkUserIdDuplicate !== 'function') {
                    console.warn('AuthService ì¤‘ë³µ í™•ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°œë°œ ëª¨ë“œë¡œ ì§„í–‰í•©ë‹ˆë‹¤.');
                    statusElement.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤. (ê°œë°œëª¨ë“œ)';
                    statusElement.className = 'field-status valid';
                    inputElement.className = 'form-input valid';
                    isUserIdValid = true;
                    return;
                }
                
                const result = await authService.checkUserIdDuplicate(userId);
                
                if (result.available) {
                    statusElement.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                    statusElement.className = 'field-status valid';
                    inputElement.className = 'form-input valid';
                    isUserIdValid = true;
                } else {
                    statusElement.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                    statusElement.className = 'field-status invalid';
                    inputElement.className = 'form-input invalid';
                    isUserIdValid = false;
                }
            } catch (error) {
                console.error('ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ê°œë°œ ëª¨ë“œë¡œ í†µê³¼ í—ˆìš©
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    statusElement.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤. (ë¡œì»¬ ê°œë°œëª¨ë“œ)';
                    statusElement.className = 'field-status valid';
                    inputElement.className = 'form-input valid';
                    isUserIdValid = true;
                } else {
                    statusElement.textContent = 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    statusElement.className = 'field-status invalid';
                    inputElement.className = 'form-input invalid';
                    isUserIdValid = false;
                }
            }
        }

        // ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸
        async function checkNicknameDuplicate() {
            const nickname = document.getElementById('nickname').value;
            const statusElement = document.getElementById('nicknameStatus');
            const inputElement = document.getElementById('nickname');
            
            if (!nickname || nickname.length < 2) {
                statusElement.textContent = 'ë‹‰ë„¤ì„ì€ 2ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                statusElement.className = 'field-status invalid';
                inputElement.className = 'form-input invalid';
                isNicknameValid = false;
                return;
            }
            
            try {
                statusElement.textContent = 'ì¤‘ë³µ í™•ì¸ ì¤‘...';
                statusElement.className = 'field-status checking';
                inputElement.className = 'form-input checking';
                
                // authServiceê°€ ì—†ê±°ë‚˜ í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í†µê³¼ (ê°œë°œ ëª¨ë“œ)
                if (!window.authService || typeof window.authService.checkNicknameDuplicate !== 'function') {
                    console.warn('AuthService ì¤‘ë³µ í™•ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°œë°œ ëª¨ë“œë¡œ ì§„í–‰í•©ë‹ˆë‹¤.');
                    statusElement.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. (ê°œë°œëª¨ë“œ)';
                    statusElement.className = 'field-status valid';
                    inputElement.className = 'form-input valid';
                    isNicknameValid = true;
                    return;
                }
                
                const result = await authService.checkNicknameDuplicate(nickname);
                
                if (result.available) {
                    statusElement.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.';
                    statusElement.className = 'field-status valid';
                    inputElement.className = 'form-input valid';
                    isNicknameValid = true;
                } else {
                    statusElement.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.';
                    statusElement.className = 'field-status invalid';
                    inputElement.className = 'form-input invalid';
                    isNicknameValid = false;
                }
            } catch (error) {
                console.error('ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ê°œë°œ ëª¨ë“œë¡œ í†µê³¼ í—ˆìš©
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    statusElement.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. (ë¡œì»¬ ê°œë°œëª¨ë“œ)';
                    statusElement.className = 'field-status valid';
                    inputElement.className = 'form-input valid';
                    isNicknameValid = true;
                } else {
                    statusElement.textContent = 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    statusElement.className = 'field-status invalid';
                    inputElement.className = 'form-input invalid';
                    isNicknameValid = false;
                }
            }
        }

        // í•¸ë“œí° ë³¸ì¸ì¸ì¦ ìš”ì²­ (Firebase ì‚¬ìš©)
        async function requestPhoneVerification() {
            const phone = document.getElementById('phone').value;
            const phoneStatus = document.getElementById('phoneStatus');
            const requestBtn = document.getElementById('requestVerificationBtn');
            const recaptchaContainer = document.getElementById('recaptcha-container');
            
            // í•¸ë“œí° ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            const phonePattern = /^010-\d{4}-\d{4}$/;
            if (!phone || !phonePattern.test(phone)) {
                phoneStatus.textContent = 'ì˜¬ë°”ë¥¸ í•¸ë“œí° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (010-0000-0000)';
                phoneStatus.className = 'field-status invalid';
                return;
            }
            
            try {
                // ë¡œë”© ìƒíƒœ
                requestBtn.disabled = true;
                requestBtn.textContent = 'ë°œì†¡ì¤‘...';
                phoneStatus.textContent = 'ì¸ì¦ë²ˆí˜¸ë¥¼ ë°œì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                phoneStatus.className = 'field-status checking';
                
                // Firebase ì¸ì¦ ì„œë¹„ìŠ¤ ì‚¬ìš©
                let result;
                if (window.phoneAuthService) {
                    result = await phoneAuthService.requestVerification(phone);
                    
                    // ì‹¤ì œ SMS ë°œì†¡ ì„±ê³µ
                    if (result.success) {
                        startVerificationTimer();
                    }
                } else {
                    throw new Error('ì „í™”ë²ˆí˜¸ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
                
                if (result.success) {
                    // ì„±ê³µ ë©”ì‹œì§€
                    phoneStatus.textContent = result.message;
                    phoneStatus.className = 'field-status valid';
                    
                    // ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
                    document.getElementById('verificationSection').style.display = 'block';
                    
                    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    requestBtn.textContent = 'ì¬ë°œì†¡';
                    requestBtn.disabled = false;
                    requestBtn.style.opacity = '1';
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                console.error('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì˜¤ë¥˜:', error);
                
                // ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
                let userMessage = error.message;
                if (error.message.includes('reCAPTCHAê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')) {
                    userMessage = 'reCAPTCHA ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('reCAPTCHAê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')) {
                    userMessage = 'reCAPTCHAë¥¼ ë¨¼ì € ì²´í¬í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('reCAPTCHA ì¸ì¦ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤')) {
                    userMessage = 'reCAPTCHAë¥¼ ë‹¤ì‹œ ì²´í¬í•œ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
                
                phoneStatus.textContent = userMessage;
                phoneStatus.className = 'field-status invalid';
                requestBtn.disabled = true;
                requestBtn.style.opacity = '0.6';
                requestBtn.textContent = 'ë³¸ì¸ì¸ì¦';
            }
        }

        // ì¸ì¦ë²ˆí˜¸ í™•ì¸ (Firebase ì‚¬ìš©)
        async function verifyPhoneCode() {
            const inputCode = document.getElementById('verificationCode').value;
            const codeStatus = document.getElementById('verificationCodeStatus');
            const verifyBtn = document.querySelector('#verificationSection .check-btn');
            
            if (!inputCode || inputCode.length !== 6) {
                codeStatus.textContent = '6ìë¦¬ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                codeStatus.className = 'field-status invalid';
                return;
            }
            
            try {
                // ë¡œë”© ìƒíƒœ
                verifyBtn.disabled = true;
                verifyBtn.textContent = 'í™•ì¸ì¤‘...';
                codeStatus.textContent = 'ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                codeStatus.className = 'field-status checking';
                
                // PhoneAuthServiceë¥¼ í†µí•œ ì‹¤ì œ Firebase ì¸ì¦
                if (!window.phoneAuthService || !window.phoneAuthService.confirmationResult) {
                    throw new Error('ì¸ì¦ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìš”ì²­í•´ì£¼ì„¸ìš”.');
                }
                
                const result = await phoneAuthService.verifyCode(inputCode);
                
                if (result.success) {
                    codeStatus.textContent = result.message;
                    codeStatus.className = 'field-status valid';
                    isPhoneVerified = true;
                    
                    // ì¸ì¦ ì™„ë£Œ í›„ UI ë¹„í™œì„±í™”
                    document.getElementById('verificationCode').disabled = true;
                    verifyBtn.disabled = true;
                    verifyBtn.textContent = 'ì¸ì¦ì™„ë£Œ';
                    document.getElementById('resendBtn').disabled = true;
                    document.getElementById('verificationTimer').textContent = 'ì¸ì¦ì™„ë£Œ';
                    
                    // reCAPTCHA ì»¨í…Œì´ë„ˆ ìˆ¨ê¸°ê¸°
                    document.getElementById('recaptcha-container').style.display = 'none';
                    
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                console.error('ì¸ì¦ë²ˆí˜¸ í™•ì¸ ì˜¤ë¥˜:', error);
                codeStatus.textContent = error.message || 'ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                codeStatus.className = 'field-status invalid';
                isPhoneVerified = false;
                verifyBtn.disabled = false;
                verifyBtn.textContent = 'í™•ì¸';
            }
        }

        // ì¸ì¦ íƒ€ì´ë¨¸ ì‹œì‘ (PhoneAuthServiceê°€ ì—†ì„ ë•Œ Fallbackìš©)
        function startVerificationTimer() {
            // PhoneAuthServiceê°€ íƒ€ì´ë¨¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²½ìš° ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (window.phoneAuthService && window.phoneAuthService.verificationTimer) {
                return;
            }
            
            timeLeft = 180; // 3ë¶„ ì´ˆê¸°í™”
            const timerElement = document.getElementById('verificationTimer');
            const resendBtn = document.getElementById('resendBtn');
            
            // ì¬ë°œì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
            if (resendBtn) resendBtn.disabled = true;
            
            verificationTimer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                if (timerElement) {
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(verificationTimer);
                    if (timerElement) timerElement.textContent = 'ì‹œê°„ì´ˆê³¼';
                    if (resendBtn) resendBtn.disabled = false;
                    // íƒ€ì´ë¨¸ ì •ë¦¬
                }
                
                timeLeft--;
            }, 1000);
        }

        // íšŒì› ìœ í˜• ì„ íƒ
        function selectMemberType(type) {
            // ëª¨ë“  ì„ íƒ í•´ì œ
            document.querySelectorAll('.member-type-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // ì„ íƒí•œ í•­ëª© í™œì„±í™”
            const selectedItem = document.querySelector(`.member-type-item input[value="${type}"]`).closest('.member-type-item');
            selectedItem.classList.add('selected');
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬
            const radioId = selectedItem.querySelector('input').id;
            document.getElementById(radioId).checked = true;
            selectedMemberType = type;
            
            // ìƒì„¸ ì •ë³´ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            const additionalSection = document.getElementById('additionalInfoSection');
            if (type !== 'ì¼ë°˜') {
                additionalSection.style.display = 'block';
            } else {
                additionalSection.style.display = 'none';
            }
            
            // ì‹¤ë¬´ì ì¸ì¦ ì•ˆë‚´ í‘œì‹œ/ìˆ¨ê¹€
            const practitionerNotice = document.getElementById('practitionerNotice');
            if (type === 'ë¶„ì–‘ê¸°íš' || type === 'ê´€ê³„ì‚¬') {
                practitionerNotice.style.display = 'block';
            } else {
                practitionerNotice.style.display = 'none';
            }
        }

        // ì•½ê´€ ê°œë³„ í† ê¸€
        function toggleTerm(termId) {
            termsAgreed[termId] = !termsAgreed[termId];
            
            const checkbox = document.getElementById(termId + 'Check');
            const checkIcon = checkbox.querySelector('i');
            
            if (termsAgreed[termId]) {
                checkbox.classList.add('checked');
                checkIcon.style.display = 'block';
            } else {
                checkbox.classList.remove('checked');
                checkIcon.style.display = 'none';
            }
            
            // ì „ì²´ ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateAllTermsState();
        }

        // ì „ì²´ ì•½ê´€ ë™ì˜ í† ê¸€
        function toggleAllTerms() {
            const allChecked = termsAgreed.terms1 && termsAgreed.terms2 && termsAgreed.terms3;
            const newState = !allChecked;
            
            // ëª¨ë“  ì•½ê´€ ìƒíƒœ ë³€ê²½
            Object.keys(termsAgreed).forEach(termId => {
                termsAgreed[termId] = newState;
                
                const checkbox = document.getElementById(termId + 'Check');
                const checkIcon = checkbox.querySelector('i');
                
                if (newState) {
                    checkbox.classList.add('checked');
                    checkIcon.style.display = 'block';
                } else {
                    checkbox.classList.remove('checked');
                    checkIcon.style.display = 'none';
                }
            });
            
            // ì „ì²´ ë™ì˜ ì²´í¬ë°•ìŠ¤ ì—…ë°ì´íŠ¸
            updateAllTermsState();
        }

        // ì „ì²´ ì•½ê´€ ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateAllTermsState() {
            const allTermsCheck = document.getElementById('allTermsCheck');
            const allTermsIcon = allTermsCheck.querySelector('i');
            const termsAllContainer = document.querySelector('.terms-all');
            
            const allChecked = termsAgreed.terms1 && termsAgreed.terms2 && termsAgreed.terms3;
            
            if (allChecked) {
                allTermsCheck.classList.add('checked');
                allTermsIcon.style.display = 'block';
                termsAllContainer.classList.add('checked');
            } else {
                allTermsCheck.classList.remove('checked');
                allTermsIcon.style.display = 'none';
                termsAllContainer.classList.remove('checked');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
        function validatePassword(password) {
            const lengthReq = document.getElementById('lengthReq');
            const specialReq = document.getElementById('specialReq');
            const numberReq = document.getElementById('numberReq');
            
            const hasMinLength = password.length >= 8;
            const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password);
            const hasNumber = /\d/.test(password);
            
            // ê¸¸ì´ ìš”êµ¬ì‚¬í•­
            if (hasMinLength) {
                lengthReq.textContent = 'âœ“ 8ì ì´ìƒ';
                lengthReq.className = 'requirement valid';
            } else {
                lengthReq.textContent = 'âœ— 8ì ì´ìƒ';
                lengthReq.className = 'requirement invalid';
            }
            
            // íŠ¹ìˆ˜ë¬¸ì ìš”êµ¬ì‚¬í•­
            if (hasSpecialChar) {
                specialReq.textContent = 'âœ“ íŠ¹ìˆ˜ë¬¸ì';
                specialReq.className = 'requirement valid';
            } else {
                specialReq.textContent = 'âœ— íŠ¹ìˆ˜ë¬¸ì';
                specialReq.className = 'requirement invalid';
            }
            
            // ìˆ«ì ìš”êµ¬ì‚¬í•­ (ê¶Œì¥)
            if (hasNumber) {
                numberReq.textContent = 'âœ“ ìˆ«ì';
                numberReq.className = 'requirement valid';
            } else {
                numberReq.textContent = 'âœ— ìˆ«ì';
                numberReq.className = 'requirement optional';
            }
            
            return hasMinLength && hasSpecialChar;
        }

        // ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
        document.getElementById('userId').addEventListener('input', function() {
            isUserIdValid = false;
            const statusElement = document.getElementById('userIdStatus');
            statusElement.textContent = '';
            statusElement.className = 'field-status';
            this.className = 'form-input';
        });

        document.getElementById('nickname').addEventListener('input', function() {
            isNicknameValid = false;
            const statusElement = document.getElementById('nicknameStatus');
            statusElement.textContent = '';
            statusElement.className = 'field-status';
            this.className = 'form-input';
        });

        // ë¹„ë°€ë²ˆí˜¸ ì‹¤ì‹œê°„ ê²€ì‚¬
        document.getElementById('password').addEventListener('input', function() {
            const password = this.value;
            const isValid = validatePassword(password);
            const statusElement = document.getElementById('passwordStatus');
            
            if (password.length === 0) {
                statusElement.textContent = '';
                statusElement.className = 'field-status';
            } else if (isValid) {
                statusElement.textContent = 'ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
                statusElement.className = 'field-status valid';
            } else {
                statusElement.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                statusElement.className = 'field-status invalid';
            }
        });

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì‹¤ì‹œê°„ ê²€ì‚¬
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            const statusElement = document.getElementById('confirmPasswordStatus');
            
            if (confirmPassword && password !== confirmPassword) {
                statusElement.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                statusElement.className = 'field-status invalid';
                this.className = 'form-input invalid';
            } else if (confirmPassword && password === confirmPassword) {
                statusElement.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.';
                statusElement.className = 'field-status valid';
                this.className = 'form-input valid';
            } else {
                statusElement.textContent = '';
                statusElement.className = 'field-status';
                this.className = 'form-input';
            }
        });

        // í¼ ì œì¶œ ì²˜ë¦¬
        async function handleSignup(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const loading = submitBtn.querySelector('.loading');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            // ë¡œë”© ìƒíƒœ ì‹œì‘
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            loading.classList.add('show');
            errorMessage.textContent = '';
            errorMessage.classList.remove('show');
            successMessage.textContent = '';
            successMessage.classList.remove('show');
            
            try {
                // ìœ íš¨ì„± ê²€ì‚¬
                if (!isUserIdValid) {
                    throw new Error('ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                }
                
                if (!isNicknameValid) {
                    throw new Error('ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                }
                
                if (!isPhoneVerified) {
                    throw new Error('í•¸ë“œí° ë³¸ì¸ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                }
                
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // ë¹„ë°€ë²ˆí˜¸ ê·œì¹™ ê²€ì‚¬
                if (!validatePassword(password)) {
                    throw new Error('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©° íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.');
                }
                
                if (password !== confirmPassword) {
                    throw new Error('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                
                if (!selectedMemberType) {
                    throw new Error('íšŒì› ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
                
                if (!termsAgreed.terms1 || !termsAgreed.terms2) {
                    throw new Error('í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                }
                
                // í¼ ë°ì´í„° ìˆ˜ì§‘
                const formData = {
                    username: document.getElementById('userId').value,
                    password: password,
                    nickname: document.getElementById('nickname').value,
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    memberType: selectedMemberType,
                    additionalInfo: {
                        company: document.getElementById('company')?.value || '',
                        department: document.getElementById('department')?.value || '',
                        experience: document.getElementById('experience')?.value || ''
                    },
                    additionalData: {
                        marketingConsent: termsAgreed.terms3
                    }
                };
                
                // authService ì‚¬ìš© ê°€ëŠ¥í•œì§€ í™•ì¸
                if (window.authService && typeof window.authService.signUp === 'function') {
                    const result = await authService.signUp(
                        formData.username,
                        formData.password,
                        formData.nickname,
                        formData.fullName,
                        formData.email,
                        formData.phone,
                        formData.memberType,
                        formData.additionalInfo,
                        formData.additionalData
                    );
                    
                    if (result.success) {
                        successMessage.textContent = 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.';
                        successMessage.classList.add('show');
                        
                        // 3ì´ˆ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 3000);
                    } else {
                        throw new Error(result.error || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } else {
                    // í´ë°± ì²˜ë¦¬
                    console.warn('AuthServiceë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í´ë°± ì²˜ë¦¬ ì¤‘...');
                    window.fallbackSignup(formData);
                }
                
            } catch (error) {
                console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                
                let errorText = error.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.message.includes('Email already registered')) {
                    errorText = 'ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                } else if (error.message.includes('Email address') && error.message.includes('is invalid')) {
                    errorText = 'Supabase SMTP ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì„ì‹œ ì´ë©”ì¼ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.';
                } else if (error.message.includes('Password should be at least')) {
                    errorText = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©° íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.';
                }
                
                errorMessage.textContent = errorText;
                errorMessage.classList.add('show');
            } finally {
                // ë¡œë”© ìƒíƒœ ì¢…ë£Œ
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                loading.classList.remove('show');
            }
        }
        
        // ì¸ì¦ë²ˆí˜¸ ì…ë ¥ í•„ë“œì— ìˆ«ìë§Œ í—ˆìš©
        document.getElementById('verificationCode').addEventListener('input', function(e) {
            // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±°
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // í•¸ë“œí° ì…ë ¥ ìƒíƒœ ì´ˆê¸°í™”
        document.getElementById('phone').addEventListener('input', () => {
            isPhoneVerified = false;
            document.getElementById('phoneStatus').textContent = '';
            document.getElementById('phoneStatus').className = 'field-status';
            
            // ì¸ì¦ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const verificationSection = document.getElementById('verificationSection');
            const recaptchaContainer = document.getElementById('recaptcha-container');
            if (verificationSection.style.display !== 'none') {
                verificationSection.style.display = 'none';
                recaptchaContainer.style.display = 'none';
                
                // Firebase reCAPTCHA ì •ë¦¬
                if (window.firebaseService) {
                    firebaseService.clearExistingRecaptcha();
                }
                
                // íƒ€ì´ë¨¸ ì •ë¦¬
                if (window.phoneAuthService) {
                    phoneAuthService.reset();
                } else {
                    clearInterval(verificationTimer);
                }
            }
            
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
            const requestBtn = document.getElementById('requestVerificationBtn');
            requestBtn.textContent = 'ë³¸ì¸ì¸ì¦';
            requestBtn.disabled = true;  // reCAPTCHA ì²´í¬ ì „ê¹Œì§€ ë¹„í™œì„±í™”
            requestBtn.style.opacity = '0.6';
        });

        // Enter í‚¤ë¡œ ë‹¤ìŒ ì…ë ¥ í•„ë“œë¡œ ì´ë™
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.target.classList.contains('form-input')) {
                const form = document.getElementById('signupForm');
                const inputs = Array.from(form.querySelectorAll('input[type="text"], input[type="email"], input[type="password"], input[type="tel"], select'));
                const currentIndex = inputs.indexOf(e.target);
                
                if (currentIndex < inputs.length - 1) {
                    e.preventDefault();
                    inputs[currentIndex + 1].focus();
                }
            }
        });
    </script>
</body>
</html>