<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출석체크 디버그</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="attendance.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            padding: 40px;
            background: #f5f5f5;
        }
        .debug-info {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 2px solid #0066ff;
        }
        .debug-info h2 {
            color: #0066ff;
            margin-top: 0;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h2>🔍 출석 명단 디버그 페이지</h2>
        <button onclick="testRender()">렌더링 테스트</button>
        <button onclick="clearConsole()">콘솔 클리어</button>
        <div class="console-output" id="consoleOutput"></div>
    </div>
    
    <!-- 오늘의 출석 현황 섹션 -->
    <div class="today-attendance">
        <h2 class="section-title">
            <i class="fas fa-users"></i>
            오늘의 출석 현황 (상위 30명)
        </h2>
        <div class="attendance-list" id="attendanceList">
            <!-- JavaScript로 동적 생성됩니다 -->
        </div>
    </div>

    <script>
        // 콘솔 출력 캡처
        const consoleOutput = document.getElementById('consoleOutput');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            consoleOutput.innerHTML += `<div style="color: #0f0">[LOG] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            consoleOutput.innerHTML += `<div style="color: #f00">[ERROR] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        function clearConsole() {
            consoleOutput.innerHTML = '';
        }
        
        // 테스트 데이터
        const attendanceData = [
            { rank: 1, name: '김영업왕', userId: 'kimyoung', time: '07:58', message: '오늘도 첫 출석! 좋은 하루 되세요!', streak: 25, badge: '소통왕', isCouponWinner: false },
            { rank: 2, name: '이기획신', userId: 'leeplan', time: '08:03', message: '일찍 일어나는 새가 벌레를 잡는다!', streak: 18, badge: '열정맨', isCouponWinner: true },
            { rank: 3, name: '박팀장님', userId: 'parkteam', time: '08:12', message: '오늘도 팀원들과 함께 화이팅!', streak: 31, badge: '베테랑', isCouponWinner: false },
            { rank: 4, name: '최전문가', userId: 'choiexpert', time: '08:18', message: '전문성으로 무장한 하루 시작!', streak: 12, badge: '전문가', isCouponWinner: false },
            { rank: 5, name: '정분양스타', userId: 'jungstar', time: '08:25', message: '분양의 달인이 출석했습니다', streak: 22, badge: '스타', isCouponWinner: false }
        ];
        
        const currentUser = {
            name: '박승학',
            userId: 'parksh',
            rank: 25,
            isCheckedIn: false,
            streak: 7,
            badge: '초보자'
        };
        
        function testRender() {
            console.log('=== 렌더링 테스트 시작 ===');
            
            const attendanceList = document.getElementById('attendanceList');
            if (!attendanceList) {
                console.error('❌ attendanceList 요소를 찾을 수 없습니다');
                return;
            }
            
            console.log('✅ attendanceList 요소 발견');
            console.log('📊 데이터 개수:', attendanceData.length);
            
            let htmlContent = '';
            
            attendanceData.forEach((user, index) => {
                const isMyRank = user.name === currentUser.name;
                const rankClass = user.rank <= 3 ? `top-three rank-${user.rank}` : '';
                
                // 메달 아이콘 설정
                let medalIcon = '';
                if (user.rank === 1) {
                    medalIcon = '<i class="fas fa-medal medal-gold"></i>';
                } else if (user.rank === 2) {
                    medalIcon = '<i class="fas fa-medal medal-silver"></i>';
                } else if (user.rank === 3) {
                    medalIcon = '<i class="fas fa-medal medal-bronze"></i>';
                }
                
                // 등수별 포인트
                let points = 300;
                if (user.rank >= 1 && user.rank <= 3) {
                    points = 1000;
                } else if (user.rank >= 4 && user.rank <= 10) {
                    points = 800;
                } else if (user.rank >= 11 && user.rank <= 30) {
                    points = 500;
                }
                
                htmlContent += `
                    <div class="attendance-item ${isMyRank ? 'my-rank' : ''}">
                        <div class="rank-wrapper">
                            ${medalIcon}
                            <span class="rank-number ${rankClass}">${user.rank}등</span>
                        </div>
                        <div class="check-time">${user.time}</div>
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-name-wrapper">
                            <span class="user-id">${user.userId}</span>
                            <span class="user-badge">${user.badge}</span>
                        </div>
                        <div class="user-message">${user.message}</div>
                        ${user.isCouponWinner ? '<div class="coupon-winner"><i class="fas fa-ticket-alt"></i> 쿠폰 당첨!</div>' : ''}
                        <div class="points-badge">+${points}P</div>
                    </div>
                `;
            });
            
            console.log('📝 HTML 생성 완료, 길이:', htmlContent.length);
            
            attendanceList.innerHTML = htmlContent;
            
            console.log('✅ 렌더링 완료!');
            console.log('📦 렌더링된 요소 개수:', attendanceList.children.length);
        }
        
        // 페이지 로드 시 자동 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 페이지 로드 완료');
            setTimeout(testRender, 100);
        });
    </script>
</body>
</html>