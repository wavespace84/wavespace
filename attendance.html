<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; font-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; connect-src 'self' https://sishloxzcqapontycuyz.supabase.co wss://sishloxzcqapontycuyz.supabase.co;"
        />
        <title>출석체크 - WAVE SPACE</title>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="preload.js"></script>
                <!-- 공통 컴포넌트 로더 -->
        <script src="js/modules/header-loader.js"></script>
        <script src="js/modules/sidebar-loader.js"></script>
        <script src="js/common-loaders.js"></script>
        <link rel="stylesheet" href="common.css?v=7" />
        <link rel="stylesheet" href="css/modules/variables.css" />
        <link rel="stylesheet" href="styles.css?v=7" />
        <link rel="stylesheet" href="css/sidebar.css?v=7" />
        <link rel="stylesheet" href="attendance.css?v=7" />
        <link rel="stylesheet" href="mobile-fix.css?v=7">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    </head>
    <body data-page="attendance">
        <!-- 전체 컨테이너 -->
        <div class="app-container">
            <!-- 사이드바 (동적 로드) -->
            <div id="sidebar-container">
                <!-- SidebarLoader가 동적으로 사이드바를 여기에 로드합니다 -->
            </div>

            <!-- 메인 컨테이너 -->
            <div class="main-container">

                <!-- 메인 콘텐츠 -->
                <main class="main-content">
                    <div class="attendance-container">
                        <!-- 헤더 -->
                        <div class="page-header">
                            <div class="attendance-header-left">
                                <h1 class="page-title">출석체크</h1>
                                <p class="page-subtitle">매일 출석하고 포인트와 배지를 획득하세요!</p>
                            </div>
                        </div>

                        <!-- 출석 현황 카드 -->
                        <div class="attendance-status-card">
                            <div class="status-content">
                                <div class="today-info">
                                    <div class="date-display">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span class="today-date">날짜 로딩중...</span>
                                    </div>
                                    <div class="check-status not-checked" id="checkStatus">
                                        <i class="fas fa-clock"></i>
                                        <span>아직 출석하지 않았습니다</span>
                                    </div>
                                </div>
                                <button class="check-in-btn" id="checkInBtn">
                                    <i class="fas fa-check-circle"></i>
                                    <span>출석하기</span>
                                    <div class="btn-shine"></div>
                                </button>
                            </div>
                            <div class="status-message">
                                <input
                                    type="text"
                                    class="message-input"
                                    placeholder="오늘의 한마디를 남겨주세요! (미입력시 자동 멘트)"
                                    maxlength="100"
                                />
                            </div>
                        </div>

                        <!-- 연속 출석 현황 -->
                        <div class="streak-info">
                            <div class="streak-card">
                                <div class="streak-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="streak-content">
                                    <span class="streak-label">이번 달 출석일수</span>
                                    <span class="streak-count">0일</span>
                                </div>
                            </div>
                            <div class="streak-card">
                                <div class="streak-icon">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div class="streak-content">
                                    <span class="streak-label">연속 출석일수</span>
                                    <span class="streak-count" id="streakCount">0일</span>
                                </div>
                            </div>
                            <div class="streak-card">
                                <div class="streak-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="streak-content">
                                    <span class="streak-label">이번 달 획득 포인트</span>
                                    <span class="streak-count">0P</span>
                                </div>
                            </div>
                            <div class="streak-card">
                                <div class="streak-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="streak-content">
                                    <span class="streak-label">이번 달 출석률</span>
                                    <span class="streak-count">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- 달력 -->
                        <div class="calendar-section">
                            <div class="calendar-header">
                                <button class="calendar-nav-btn prev">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <h2 class="calendar-title">
                                    <div class="calendar-title-wrapper current">
                                        <div class="calendar-title-main">로딩중...</div>
                                    </div>
                                </h2>
                                <button class="calendar-nav-btn next">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <div class="calendar-grid">
                                <div class="calendar-weekdays">
                                    <div class="weekday">일</div>
                                    <div class="weekday">월</div>
                                    <div class="weekday">화</div>
                                    <div class="weekday">수</div>
                                    <div class="weekday">목</div>
                                    <div class="weekday">금</div>
                                    <div class="weekday">토</div>
                                </div>
                                <div class="calendar-days">
                                    <!-- JavaScript로 동적 생성됩니다 -->
                                </div>
                            </div>
                        </div>

                        <!-- 출석 보상 정보 -->
                        <div class="rewards-section">
                            <h2 class="section-title">
                                <i class="fas fa-gift"></i>
                                출석 보상
                            </h2>
                            <div class="rewards-grid">
                                <div class="reward-card">
                                    <div class="reward-icon">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="reward-info">
                                        <h3>1~3등</h3>
                                        <p>+1000 포인트</p>
                                    </div>
                                </div>
                                <div class="reward-card">
                                    <div class="reward-icon">
                                        <i class="fas fa-medal"></i>
                                    </div>
                                    <div class="reward-info">
                                        <h3>4~10등</h3>
                                        <p>+800 포인트</p>
                                    </div>
                                </div>
                                <div class="reward-card">
                                    <div class="reward-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="reward-info">
                                        <h3>11~30등</h3>
                                        <p>+500 포인트</p>
                                    </div>
                                </div>
                                <div class="reward-card">
                                    <div class="reward-icon">
                                        <i class="fas fa-coins"></i>
                                    </div>
                                    <div class="reward-info">
                                        <h3>31등 이하</h3>
                                        <p>+300 포인트 (일일 출석)</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bonus-rewards">
                                <h3>
                                    <i class="fas fa-star"></i>
                                    추가 보너스 혜택
                                </h3>
                                <div class="bonus-grid">
                                    <div class="bonus-item special" id="bonus7days">
                                        <div class="bonus-icon">
                                            <i class="fas fa-fire"></i>
                                        </div>
                                        <div class="bonus-info">
                                            <span class="bonus-title">7일 연속 출석</span>
                                            <span class="bonus-points">+500P 보너스</span>
                                        </div>
                                    </div>
                                    <div class="bonus-item special" id="bonusMonthly">
                                        <div class="bonus-icon">
                                            <i class="fas fa-award"></i>
                                        </div>
                                        <div class="bonus-info">
                                            <span class="bonus-title">이번달 출석률 100%</span>
                                            <span class="bonus-points">+2000P + 개근상 배지</span>
                                        </div>
                                    </div>
                                    <div class="bonus-item special" id="bonusTop30">
                                        <div class="bonus-icon">
                                            <i class="fas fa-crown"></i>
                                        </div>
                                        <div class="bonus-info">
                                            <span class="bonus-title">이번달 매일 30위 순위권</span>
                                            <span class="bonus-points">+5000P + 성실검증 배지</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 오늘의 출석 현황 -->
                        <div class="today-attendance">
                            <h2 class="section-title">
                                <i class="fas fa-users"></i>
                                오늘의 출석 현황 (상위 30명)
                            </h2>
                            <div class="attendance-list" id="attendanceList">
                                <!-- JavaScript로 동적 생성됩니다 -->
                            </div>
                            <div class="coupon-section">
                                <h4>
                                    <i class="fas fa-gift"></i>
                                    오늘의 쿠폰 당첨자
                                </h4>
                                <p class="coupon-desc">
                                    상점에서 포인트로 구매 가능한 쿠폰을 등수 구간별로 랜덤하게 추첨합니다!
                                </p>
                                <div class="coupon-content">
                                    <div class="coupon-rules">
                                        <div class="rule-item">
                                            <span class="rule-range">1~3등 구간 (1명)</span>
                                            <span class="rule-prize">스타벅스 쿠폰</span>
                                            <span class="winner-badge" id="winner1">추첨 대기중</span>
                                        </div>
                                        <div class="rule-item">
                                            <span class="rule-range">4~10등 구간 (1명)</span>
                                            <span class="rule-prize">편의점 쿠폰</span>
                                            <span class="winner-badge" id="winner2">추첨 대기중</span>
                                        </div>
                                        <div class="rule-item">
                                            <span class="rule-range">11~30등 구간 (2명)</span>
                                            <span class="rule-prize">커피 쿠폰</span>
                                            <div class="winner-badges">
                                                <span class="winner-badge" id="winner3-1">추첨 대기중</span>
                                                <span class="winner-badge" id="winner3-2">추첨 대기중</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="coupon-congratulations" id="couponMessage">
                                        <i class="fas fa-info-circle"></i>
                                        30위까지 출석이 완료되면 등수 구간별로 추첨하여 쿠폰이 지급됩니다!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <script src="script.js?v=7"></script>
        <script src="js/attendance.js?v=7"></script>
        
        <!-- Supabase 통합 -->
        <script src="js/config/supabase.js?v=7"></script>
        <script src="js/services/authService.js?v=7"></script>
        <script type="module" src="js/pages/attendanceSupabase.js?v=7"></script>
        <script>
            // 디버그용 - 페이지 로드 확인
            console.log('attendance.html 페이지 로드됨');

            // F12 콘솔에서 확인할 수 있도록 전역 변수로 노출
            window.debugAttendance = function () {
                console.log('출석 버튼:', document.getElementById('checkInBtn'));
                console.log('출석 리스트:', document.getElementById('attendanceList'));
                console.log('메시지 입력:', document.querySelector('.message-input'));
                console.log('출석 데이터:', typeof attendanceData !== 'undefined' ? attendanceData : 'undefined');
            };

            // 3초 후 자동으로 디버그 정보 출력
            setTimeout(() => {
                console.log('=== 자동 디버그 정보 ===');
                window.debugAttendance();
            }, 3000);
        </script>
        <!-- ES6 모듈 메인 스크립트 -->
    <script type="module" src="js/main.js?v=7"></script>
    
</body>
</html>
